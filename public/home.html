<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Home | Logify</title>
    <link rel="stylesheet" href="homestyle.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
  </head>
  <body>
    <!-- NAVBAR -->
    <nav class="navbar">
      <div class="logo">LOGIFY</div>

      <div class="user-menu" onclick="toggleDropdown()">
        <div class="timer-box" id="loginTimer">00:00:00</div>
        <span id="username"></span>
        <i class="fa-solid fa-user-circle"></i>

        <div class="dropdown" id="dropdown">
          <a href="#">Profile</a>
          <a href="#" onclick="logout()">Logout</a>
        </div>
      </div>
    </nav>

    <!-- HOME CONTENT -->
    <div class="home-container card">
      <h1>ðŸŽ‰ Welcome to Logify</h1>
      <p>You have successfully logged in.</p>
    </div>
    <!-- <script>
      const user = localStorage.getItem("loggedInUser");
      const loginTime = localStorage.getItem("loginTime");

      if (!user || !loginTime) {
        window.location.href = "login.html";
      } else {
        document.getElementById("username").innerText = user;
        startTimer(loginTime);
      }

      function startTimer(startTime) {
        setInterval(() => {
          const now = Date.now();
          const diff = now - startTime;

          const hours = Math.floor(diff / (1000 * 60 * 60));
          const minutes = Math.floor((diff / (1000 * 60)) % 60);
          const seconds = Math.floor((diff / 1000) % 60);

          document.getElementById("loginTimer").innerText = `${pad(
            hours
          )}:${pad(minutes)}:${pad(seconds)}`;
        }, 1000);
      }

      function pad(num) {
        return num.toString().padStart(2, "0");
      }

      function toggleDropdown() {
        document.getElementById("dropdown").classList.toggle("show");
      }

      function logout() {
        localStorage.removeItem("loggedInUser");
        localStorage.removeItem("loginTime");
        window.location.href = "login.html";
      }

      window.onclick = function (event) {
        if (!event.target.closest(".user-menu")) {
          document.getElementById("dropdown").classList.remove("show");
        }
      };
    </script> -->
    <script>
  console.log("ðŸ  Home page loaded");

  // ðŸ”¥ Wait for extension + storage sync
  window.addEventListener("load", () => {
    setTimeout(() => {
      const user = localStorage.getItem("loggedInUser");

      if (!user) {
        console.warn("âŒ No active session found");
        window.location.replace("login.html");
        return;
      }

      console.log("âœ… Active session:", user);

      // Show username in navbar
      const usernameEl = document.getElementById("username");
      if (usernameEl) {
        usernameEl.innerText = user;
      }

      // ===== SESSION TIMER =====
      let startTime = localStorage.getItem("loginTime");

      if (!startTime) {
        startTime = Date.now();
        localStorage.setItem("loginTime", startTime);
      }

      const timerEl = document.getElementById("loginTimer");

      function updateTimer() {
        const now = Date.now();
        const diff = now - startTime;

        const seconds = Math.floor(diff / 1000) % 60;
        const minutes = Math.floor(diff / (1000 * 60)) % 60;
        const hours = Math.floor(diff / (1000 * 60 * 60));

        if (timerEl) {
          timerEl.innerText =
            `${hours.toString().padStart(2, "0")}:` +
            `${minutes.toString().padStart(2, "0")}:` +
            `${seconds.toString().padStart(2, "0")}`;
        }
      }

      setInterval(updateTimer, 1000);
      updateTimer();
    }, 500); // ðŸ”‘ VERY IMPORTANT DELAY
  });

  // ===== DROPDOWN =====
  function toggleDropdown() {
    document.getElementById("dropdown")?.classList.toggle("show");
  }

  // ===== LOGOUT =====
  function logout() {
    console.log("ðŸšª Logging out...");
    localStorage.removeItem("loggedInUser");
    localStorage.removeItem("loginTime");
    window.location.replace("login.html");
  }

  // Close dropdown on outside click
  window.addEventListener("click", (event) => {
    if (!event.target.closest(".user-menu")) {
      document.getElementById("dropdown")?.classList.remove("show");
    }
  });
</script>

  </body>
</html>
